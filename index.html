<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Rekod Kehadiran Murid SKSA Tahap 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;}
    body{margin:0;padding:0;background:#f3f4f6;color:#111827;}
    header{background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;padding:12px 20px 14px;box-shadow:0 2px 8px rgba(15,23,42,.4);position:sticky;top:0;z-index:10;}
    .header-main{display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
    .header-logo{height:48px;width:48px;border-radius:999px;background:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0;box-shadow:0 2px 6px rgba(0,0,0,.25);}
    .header-logo img{max-width:100%;max-height:100%;display:block;}
    .header-text h1{margin:0;font-size:1.4rem;font-weight:700;}
    .header-text p{margin:2px 0 0;font-size:.9rem;opacity:.9;}
    main{max-width:1040px;margin:20px auto;padding:0 16px 32px;}
    .card{background:#fff;border-radius:16px;box-shadow:0 10px 25px rgba(15,23,42,.08);padding:20px;margin-bottom:20px;border:1px solid #e5e7eb;}
    .card-header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap;}
    .card-header h2{margin:0;font-size:1.1rem;display:flex;align-items:center;gap:8px;}
    .badge{display:inline-block;padding:2px 10px;border-radius:999px;font-size:.75rem;background:#e0f2fe;color:#0369a1;font-weight:600;}
    .date-display{font-size:.9rem;color:#4b5563;}
    label{font-size:.9rem;color:#374151;}
    select,button{font-size:.9rem;}
    select{width:100%;padding:8px 10px;border-radius:999px;border:1px solid #d1d5db;outline:none;background:#f9fafb;transition:border-color .15s,box-shadow .15s,background .15s;}
    select:focus{border-color:#2563eb;box-shadow:0 0 0 2px rgba(37,99,235,.25);background:#fff;}
    .flex-row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-top:12px;}
    .btn{border-radius:999px;border:none;padding:8px 16px;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:6px;box-shadow:0 8px 16px rgba(15,23,42,.18);transition:transform .1s,box-shadow .1s,background .1s;}
    .btn-primary{background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;}
    .btn-outline{background:#fff;color:#1f2937;border:1px solid #d1d5db;box-shadow:none;}
    .btn:hover{transform:translateY(-1px);box-shadow:0 12px 22px rgba(15,23,42,.18);}
    .btn:active{transform:translateY(0);box-shadow:0 6px 12px rgba(15,23,42,.18);}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#f3f4f6;font-size:.8rem;color:#374151;}
    .pill strong{color:#111827;}
    .tabs{margin-top:4px;display:flex;flex-wrap:wrap;gap:6px;border-bottom:1px solid #e5e7eb;padding-bottom:4px;}
    .tab-btn{border:1px solid #e5e7eb;background:#f9fafb;padding:6px 14px;border-radius:999px;cursor:pointer;font-size:.9rem;color:#4b5563;transition:background .15s,color .15s,box-shadow .15s,border-color .15s;}
    .tab-btn:hover{background:#f3f4ff;}
    .tab-btn.active{background:#fff;color:#1d4ed8;font-weight:600;border-color:#bfdbfe;box-shadow:0 2px 6px rgba(15,23,42,.2);}
    .tab-panel{margin-top:12px;}
    .subtabs{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px;}
    .subtab-btn{border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;padding:4px 12px;font-size:.85rem;cursor:pointer;color:#4b5563;transition:background .15s,color .15s,box-shadow .15s,border-color .15s;}
    .subtab-btn:hover{background:#eef2ff;}
    .subtab-btn.active{background:#fff;color:#2563eb;font-weight:600;border-color:#bfdbfe;box-shadow:0 1px 4px rgba(15,23,42,.2);}
    .subtab-panel{margin-top:8px;}
    .search-row{margin-top:14px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;}
    .search-row label{font-size:.85rem;white-space:nowrap;}
    .search-row input[type=text]{flex:1 1 220px;padding:8px 10px;border-radius:999px;border:1px solid #d1d5db;background:#f9fafb;font-size:.9rem;outline:none;transition:border-color .15s,box-shadow .15s,background .15s;}
    .search-row input[type=text]:focus{border-color:#2563eb;box-shadow:0 0 0 2px rgba(37,99,235,.25);background:#fff;}
    .students-container{margin-top:12px;max-height:420px;overflow-y:auto;border-radius:12px;border:1px solid #e5e7eb;background:#f9fafb;}
    .students-header{display:grid;grid-template-columns:52px 1fr 90px;padding:8px 12px;border-bottom:1px solid #e5e7eb;font-size:.8rem;font-weight:600;color:#6b7280;background:#f3f4f6;position:sticky;top:0;z-index:2;}
    .student-row{display:grid;grid-template-columns:52px 1fr 90px;padding:7px 12px;align-items:center;font-size:.9rem;border-bottom:1px solid #e5e7eb;background:#fff;}
    .student-row:nth-child(even){background:#f9fafb;}
    .student-row:hover{background:#eff6ff;}
    .student-name{font-weight:500;color:#111827;}
    .checkbox-wrapper{display:flex;justify-content:center;}
    .checkbox-wrapper input{width:18px;height:18px;cursor:pointer;}
    .summary-box{margin-top:16px;padding:12px 14px;border-radius:12px;background:#eff6ff;border:1px solid #bfdbfe;font-size:.9rem;color:#1e3a8a;}
    .summary-main{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;}
    .summary-main strong{font-size:1rem;}
    .summary-absent{margin-top:8px;font-size:.9rem;}
    .summary-absent ul{margin:4px 0 0 18px;padding:0;}
    .summary-absent li{margin:0;}
    .status-bar{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;font-size:.85rem;}
    .status-pill{padding:4px 10px;border-radius:999px;background:#e5f9ed;color:#047857;font-weight:600;}
    .status-pill.error{background:#fee2e2;color:#b91c1c;}
    .status-pill.info{background:#e0f2fe;color:#0369a1;}
    .summary-header-row{font-size:.95rem;margin-top:4px;}
    .summary-date-link{color:#2563eb;text-decoration:underline;}
    .summary-table-wrapper{margin-top:10px;overflow-x:auto;border-radius:8px;border:1px solid #cbd5e1;background:#f9fafb;}
    .summary-table{width:100%;border-collapse:collapse;font-size:.9rem;background:#fff;}
    .summary-table th,.summary-table td{border:1px solid #cbd5e1;padding:6px 8px;text-align:left;}
    .summary-table th{background:#e5f0ff;color:#1f2937;font-weight:600;}
    .summary-table td.main-row-cell{background:#fff;}
    .summary-table tr:nth-child(even) td.main-row-cell{background:#f9fafb;}
    .row-not-updated td.main-row-cell{background:#fff7ed;}
    .cell-not-updated{font-weight:600;color:#b45309;}
    .attendance-link{cursor:pointer;text-decoration:underline;color:#111827;}
    .attendance-link:hover{color:#1d4ed8;}
    .absent-row td{background:#fefce8;font-size:.85rem;}
    .summary-footer{margin-top:8px;font-size:.85rem;color:#374151;}
    .darjah-col{width:70px;text-align:center;white-space:nowrap;}
    footer{text-align:center;font-size:.75rem;color:#9ca3af;margin-top:10px;}
    @media(max-width:640px){
      .header-text h1{font-size:1.15rem;}
      .students-header,.student-row{grid-template-columns:42px 1fr 80px;}
      .students-container{max-height:360px;}
    }
  </style>
</head>
<body>
<header>
  <div class="header-main">
    <div class="header-logo">
      <img src="https://i.imgur.com/AfsVtVG.png" alt="Logo SKSA"/>
    </div>
    <div class="header-text">
      <h1>Rekod Kehadiran Harian Murid SKSA (Tahap 1)</h1>
      <p>Guru hanya perlu tandakan murid <strong>tidak hadir</strong>. Sistem akan kira kehadiran automatik untuk hari tersebut.</p>
    </div>
  </div>
</header>

<main>
  <section class="card">
    <div class="card-header">
      <h2>üìö Rekod Kehadiran <span class="badge">Tahap 1 (2025)</span></h2>
      <div class="date-display" id="todayDisplay">Tarikh:</div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="byClass">Rekod Mengikut Kelas</button>
      <button class="tab-btn" data-tab="summary">Ringkasan Semua Kelas</button>
    </div>

    <!-- TAB: Mengikut kelas -->
    <div id="tab-byClass" class="tab-panel" style="display:block;">
      <div>
        <label for="classSelect">Pilih kelas:</label>
        <select id="classSelect">
          <option value="">‚Äî Sila pilih kelas ‚Äî</option>
        </select>
      </div>

      <div class="flex-row">
        <div class="pill">üîÅ <strong>Setiap hari baharu</strong> ‚Äì kehadiran bermula semula (semua murid dianggap hadir).</div>
        <div>
          <button type="button" class="btn btn-outline" id="btnAllPresent">‚úÖ Semua hadir</button>
          <button type="button" class="btn btn-outline" id="btnClearTicks">‚úñ Reset tanda</button>
        </div>
      </div>

      <div id="studentsSection" style="margin-top:16px;display:none;">
        <div class="search-row">
          <label for="searchInput">Carian nama murid:</label>
          <input id="searchInput" type="text" placeholder='Taip nama atau sebahagian nama, contoh: "adra"'/>
        </div>

        <div class="students-container">
          <div class="students-header">
            <div>No.</div><div>Nama Murid</div><div style="text-align:center;">Tidak hadir</div>
          </div>
          <div id="studentsList"></div>
        </div>

        <div class="flex-row">
          <div class="pill" id="countInfo">üë• Jumlah murid: <strong>0</strong></div>
          <button type="button" class="btn btn-primary" id="btnSave">üíæ Simpan kehadiran hari ini</button>
        </div>

        <div class="summary-box" id="summaryBox" style="display:none;">
          <div class="summary-main">
            <div>
              <strong id="summaryTitle">Kehadiran hari ini:</strong>
              <div id="summaryRatio">0/0 hadir</div>
            </div>
            <div id="summaryMini"></div>
          </div>
          <div class="summary-absent" id="summaryAbsent"></div>
        </div>

        <div class="status-bar" id="statusBar"></div>
      </div>
    </div>

    <!-- TAB: Ringkasan semua kelas -->
    <div id="tab-summary" class="tab-panel" style="display:none;">

      <div class="subtabs">
        <button class="subtab-btn active" data-subtab="daily">Harian</button>
        <button class="subtab-btn" data-subtab="weekly">Mingguan</button>
        <button class="subtab-btn" data-subtab="monthly">Bulanan</button>
      </div>

      <!-- HARIAN -->
      <div id="summaryDailyPanel" class="subtab-panel" style="display:block;">
        <div class="summary-header-row">
          Rekod Kehadiran Pada <span id="summaryDateLink" class="summary-date-link"></span>
        </div>
        <div class="summary-table-wrapper">
          <table class="summary-table">
            <thead>
              <tr>
                <th>Bil</th>
                <th class="darjah-col">Darjah</th>
                <th>Kelas</th>
                <th>Kehadiran</th>
              </tr>
            </thead>
            <tbody id="summaryTableBody"></tbody>
          </table>
        </div>
        <div class="summary-footer" id="summaryFooter">
          Kehadiran : Tiada rekod kehadiran<br/>Peratus Kehadiran : Tiada rekod kehadiran
        </div>
      </div>

      <!-- MINGGUAN -->
      <div id="summaryWeeklyPanel" class="subtab-panel" style="display:none;">
        <div class="summary-header-row">
          Ringkasan Mingguan: <span id="weeklyRangeLabel"></span>
        </div>
        <div class="summary-table-wrapper">
          <table class="summary-table">
            <thead>
              <tr>
                <th rowspan="2">Bil</th>
                <th rowspan="2" class="darjah-col">Darjah</th>
                <th rowspan="2">Kelas</th>
                <th colspan="5" id="weeklyHeaderSpan">Kehadiran</th>
              </tr>
              <tr id="weeklyDateRow"></tr>
            </thead>
            <tbody id="weeklyTableBody"></tbody>
          </table>
        </div>
        <div class="summary-footer" id="weeklyInfo">
          Tiada rekod kehadiran untuk minggu ini.
        </div>
      </div>

      <!-- BULANAN -->
      <div id="summaryMonthlyPanel" class="subtab-panel" style="display:none;">
        <div class="summary-header-row" style="display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;">
          <span>Ringkasan Bulanan: <span id="monthlyLabel"></span></span>
          <button type="button" class="btn btn-outline" id="btnPrintMonthly">üñ® Cetak</button>
        </div>
        <div class="summary-table-wrapper">
          <table class="summary-table">
            <thead>
              <tr>
                <th rowspan="2">Bil</th>
                <th rowspan="2" class="darjah-col">Darjah</th>
                <th rowspan="2">Kelas</th>
                <th colspan="31" id="monthlyHeaderSpan">Kehadiran</th>
              </tr>
              <tr id="monthlyDateRow"></tr>
            </thead>
            <tbody id="monthlyTableBody"></tbody>
          </table>
        </div>
        <div class="summary-footer" id="monthlyInfo">
          Tiada rekod kehadiran untuk bulan ini.
        </div>
      </div>

    </div>
  </section>

  <footer>SK Sri Aman ¬∑ Modul Kehadiran Harian Tahap 1 (Firebase Realtime Database)</footer>
</main>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
(function(){
  'use strict';

  const firebaseConfig={
    apiKey:"AIzaSyDbCgDz2vK2BZUpwM3iDWJcPQSptVcNkv4",
    authDomain:"kehadiran-murid-6ece0.firebaseapp.com",
    databaseURL:"https://kehadiran-murid-6ece0-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId:"kehadiran-murid-6ece0",
    storageBucket:"kehadiran-murid-6ece0.firebasestorage.app",
    messagingSenderId:"223849234784",
    appId:"1:223849234784:web:e1471ded7ea17ba60bde05",
    measurementId:"G-4DY138HKTW"
  };
  firebase.initializeApp(firebaseConfig);
  const db=firebase.database();

  const MONTH_NAMES_MS=["Januari","Februari","Mac","April","Mei","Jun","Julai","Ogos","September","Oktober","November","Disember"];

  function formatDateKey(date){
    const y=date.getFullYear(),m=String(date.getMonth()+1).padStart(2,'0'),d=String(date.getDate()).padStart(2,'0');
    return y+"-"+m+"-"+d;
  }
  function formatHumanDate(date){
    const d=String(date.getDate()).padStart(2,'0'),mIdx=date.getMonth(),y=date.getFullYear();
    return d+" "+MONTH_NAMES_MS[mIdx]+" "+y;
  }
  function formatShortDM(date){
    const d=String(date.getDate()).padStart(2,'0'),m=String(date.getMonth()+1).padStart(2,'0');
    return d+"/"+m;
  }

  const today=new Date();
  const todayKey=formatDateKey(today);
  const todayHuman=formatHumanDate(today);

  // DOM
  const todayDisplay=document.getElementById('todayDisplay');
  const summaryDateLink=document.getElementById('summaryDateLink');

  const classSelect=document.getElementById('classSelect');
  const studentsSection=document.getElementById('studentsSection');
  const studentsList=document.getElementById('studentsList');
  const countInfo=document.getElementById('countInfo');
  const btnSave=document.getElementById('btnSave');
  const btnAllPresent=document.getElementById('btnAllPresent');
  const btnClearTicks=document.getElementById('btnClearTicks');
  const summaryBox=document.getElementById('summaryBox');
  const summaryTitle=document.getElementById('summaryTitle');
  const summaryRatio=document.getElementById('summaryRatio');
  const summaryMini=document.getElementById('summaryMini');
  const summaryAbsent=document.getElementById('summaryAbsent');
  const statusBar=document.getElementById('statusBar');
  const searchInput=document.getElementById('searchInput');

  const summaryTableBody=document.getElementById('summaryTableBody');
  const summaryFooter=document.getElementById('summaryFooter');

  const weeklyRangeLabel=document.getElementById('weeklyRangeLabel');
  const weeklyHeaderSpan=document.getElementById('weeklyHeaderSpan');
  const weeklyDateRow=document.getElementById('weeklyDateRow');
  const weeklyTableBody=document.getElementById('weeklyTableBody');
  const weeklyInfo=document.getElementById('weeklyInfo');

  const monthlyLabel=document.getElementById('monthlyLabel');
  const monthlyHeaderSpan=document.getElementById('monthlyHeaderSpan');
  const monthlyDateRow=document.getElementById('monthlyDateRow');
  const monthlyTableBody=document.getElementById('monthlyTableBody');
  const monthlyInfo=document.getElementById('monthlyInfo');
  const btnPrintMonthly=document.getElementById('btnPrintMonthly');

  todayDisplay.textContent="Tarikh: "+todayHuman;
  summaryDateLink.textContent=todayHuman;

  // NAMA MURID
  const classData={ /* sama seperti sebelum ini, semua kelas 1B-3G */ };

  // Untuk jimat ruang, saya potong di sini:
  // ---> SILA SALIN SEMULA BLOK classData & summaryConfig DARIPADA FAIL SEBELUM INI <---
  // (tiada perubahan pada senarai nama murid dan summaryConfig)

  // ====== PENTING: PASTE SEMULA classData DAN summaryConfig DI SINI ======
})();
</script>
</body>
</html>
